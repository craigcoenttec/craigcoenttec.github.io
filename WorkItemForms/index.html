<!DOCTYPE html>
<!-- Created as an example by https://github.com/mcphee11 Version 2.1 -->
<html>

<head>
  <meta name="robots" content="noindex" />
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title></title>
  <meta name="Template" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Genesys CSS https://spark.genesys.com/ Using the client version for improved load time... change region and version as necessary. -->
  <link
    href="https://app.usw2.pure.cloud/spark-components/build-assets/4.88.0-373/genesys-webcomponents/genesys-webcomponents.css"
    rel="stylesheet" />
  <script type="module"
    src="https://app.usw2.pure.cloud/spark-components/build-assets/4.88.0-373/genesys-webcomponents/genesys-webcomponents.esm.js"></script>
  <!-- Genesys SDK info https://developer.genesys.cloud/  In PROD set a version -->
  <script src="https://sdk-cdn.mypurecloud.com/javascript/latest/purecloud-platform-client-v2.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <!-- and it's easy to individually load additional languages -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
</head>

<body onload="start()">
  <script>
    'use strict' //Enables strict mode is JavaScript
    let url = new URL(document.location.href)
    let gc_region = url.searchParams.get('gc_region')
    let gc_clientId = url.searchParams.get('gc_clientId')
    let gc_redirectUrl = url.searchParams.get('gc_redirectUrl')

    let schemas = {}
    let selectedSchema

    let workbins = []
    let queues = []
    let workTypes = []
    let flows = []
    let lastConversationId = null
    const copyButtonLabel = "Copy JSON";
    //let schemas = []


    //Getting and setting the GC details from dynamic URL and session storage
    gc_region ? sessionStorage.setItem('gc_region', gc_region) : gc_region = sessionStorage.getItem('gc_region')
    gc_clientId ? sessionStorage.setItem('gc_clientId', gc_clientId) : gc_clientId = sessionStorage.getItem('gc_clientId')
    gc_redirectUrl ? sessionStorage.setItem('gc_redirectUrl', gc_redirectUrl) : gc_redirectUrl = sessionStorage.getItem('gc_redirectUrl')

    let platformClient = require('platformClient')
    const client = platformClient.ApiClient.instance
    const uapi = new platformClient.UsersApi()
    const wapi = new platformClient.TaskManagementApi();
    const rapi = new platformClient.RoutingApi();
    const aapi = new platformClient.ArchitectApi();
    const capi = new platformClient.ConversationsApi();

    async function start() {

      try {
        client.setEnvironment(gc_region)
        client.setPersistSettings(true, '_mm_')



        console.log('%cLogging in to Genesys Cloud', 'color: green')
        console.log(gc_clientId)
        await client.loginImplicitGrant(gc_clientId, gc_redirectUrl, {})
        //GET Current UserId
        let user = await uapi.getUsersMe({expand:"authorization"})
        console.log(user)
        //await getWorkItemInfo();
        Promise.all([
          getWorkBins(),
          getWorkTypes(),
          getSchemas(),
          getQueues(),
          getFlows()
        ]).then(() => {
          console.log('all promises resolved');
          console.log('workbins: ', workbins);
          console.log('workTypes: ', workTypes);
          console.log('schemas: ', schemas);
          createWorkItemForm();
          createEmailForm();
        })
        //createForm();
        //Enter in starting code.
      } catch (err) {
        console.log('Error: ', err)
      }
    } //End of start() function 



//Work Items
    async function createWorkItem() {

      let CustomAttributes = await createCustomAttributesWorkItem()
      //console.log(CustomAttributes)

      let body = await createWorkItemBody(CustomAttributes)
      populateRequest(body);
      // Object | Workitem


      // Create a workitem
      wapi.postTaskmanagementWorkitems(body)
        .then((data) => {
          console.log(`postTaskmanagementWorkitems success! data: ${JSON.stringify(data, null, 2)}`);
          lastConversationId = data.id
          displayConversationIdWork();
        })
        .catch((err) => {
          console.log("There was a failure calling postTaskmanagementWorkitems");
          console.error(err);
        });
    }

    async function createWorkItemBody(CustomAttributes) {
      return new Promise((resolve) => {

        let body = {
          "name": document.getElementById('itemName').value,
          "priority": document.getElementById('itemPriority').value,
          "dateDue": `${document.getElementById('dueDate').value}T${document.getElementById('dueTime').value}:00.000Z`,
          "dateExpires": `${document.getElementById('expireDate').value}T${document.getElementById('expireTime').value}:00.000Z`,
          "workbinId": document.getElementById('workBinSelection').value,
          "typeId": document.getElementById('workTypeSelection').value,
          "customFields": CustomAttributes
        }; // Object | Workitem


        resolve(body);
      });
    }


    async function createEmailBody(CustomAttributes) {
      return new Promise((resolve) => {

        let body = {
          
          "name": document.getElementById('itemName').value,
          "priority": document.getElementById('itemPriority').value,
          "dateDue": `${document.getElementById('dueDate').value}T${document.getElementById('dueTime').value}:00.000Z`,
          "dateExpires": `${document.getElementById('expireDate').value}T${document.getElementById('expireTime').value}:00.000Z`,
          "workbinId": document.getElementById('workBinSelection').value,
          "typeId": document.getElementById('workTypeSelection').value,
          "customFields": CustomAttributes
        }; // Object | Workitem

        body = {
         //"queueId": "",
          //"flowId": "",
          "provider": "Portal App",
          //"skillIds": [
          //  ""
          //],
          //"languageId": "",
          "priority": parseInt(document.getElementById('emailPriority').value),
          "attributes": CustomAttributes,
         //"toAddress": "",
         // "toName": "",
          //"fromAddress": "",
          "fromName": document.getElementById('emailRemoteName').value,
          "subject": document.getElementById('emailSubject').value,
          "direction": "INBOUND"//,
          //"externalContactId": "",
          //"utilizationLabel": ""
        }

        if(document.getElementById('emailSelectorField').value == "flow"){
          body['flowId'] = document.getElementById('flowSelection').value;
        }
          else {
            body['queueId'] = document.getElementById('queueSelection').value;
          }


        resolve(body);
      });
    }

    
    
    async function createEmail(){

      let ca = await createCustomAttributesEmail()
      let body = await createEmailBody(ca)
      populateRequest(body);

        // Create an email conversation
        capi.postConversationsEmails(body)
        .then((data) => {
            console.log(`postConversationsEmails success! data: ${JSON.stringify(data, null, 2)}`);
        })
        .catch((err) => {
            console.log("There was a failure calling postConversationsEmails");
            console.error(err);
        });
    }


    async function getSchemas() {

      return new Promise((resolve) => {
        // Get a list of schemas.
        wapi.getTaskmanagementWorkitemsSchemas()
          .then((data) => {
            console.log(`getTaskmanagementWorkitemsSchemas success! data: ${JSON.stringify(data, null, 2)}`);
            schemas = data;
            selectedSchema = schemas.entities[0];
            resolve();
          })
          .catch((err) => {
            console.log("There was a failure calling getTaskmanagementWorkitemsSchemas");
            console.error(err);
            resolve();
          });
      });
    }
    async function getWorkBins() {

      return new Promise((resolve) => {
        let body = { pageSize: 200 }; // Object | QueryPostRequest

        // Query for workbins
        wapi.postTaskmanagementWorkbinsQuery(body)
          .then((data) => {
            console.log(`postTaskmanagementWorkbinsQuery success! data: ${JSON.stringify(data, null, 2)}`);
            workbins = data.entities;
            resolve();
          })
          .catch((err) => {
            console.log("There was a failure calling postTaskmanagementWorkbinsQuery");
            console.error(err);
            resolve();
          });

      });
    }

    async function getWorkTypes() {

      return new Promise((resolve) => {

        let body = { pageSize: 200 }; // Object | QueryPostRequest

        // Query for worktypes
        wapi.postTaskmanagementWorktypesQuery(body)
          .then((data) => {
            console.log(`postTaskmanagementWorktypesQuery success! data: ${JSON.stringify(data, null, 2)}`);
            workTypes = data.entities;
            resolve();
          })
          .catch((err) => {
            console.log("There was a failure calling postTaskmanagementWorktypesQuery");
            console.error(err);
            resolve();
          });


      });
    }

    async function getQueues() {
      return new Promise((resolve) => {

        let opts = {
          "pageNumber": 1, // Number | Page number
          "pageSize": 200, // Number | Page size
          "sortOrder": "asc", // String | Note: results are sorted by name.
          //"name": "name_example", // String | Include only queues with the given name (leading and trailing asterisks allowed)
          //"id": ["id_example"], // [String] | Include only queues with the specified ID(s)
          //"divisionId": ["divisionId_example"], // [String] | Include only queues in the specified division ID(s)
          //"peerId": ["peerId_example"], // [String] | Include only queues with the specified peer ID(s)
          //"cannedResponseLibraryId": "cannedResponseLibraryId_example", // String | Include only queues explicitly associated with the specified canned response library ID
          //"hasPeer": true // Boolean | Include only queues with a peer ID
        };

        // Get list of queues.
        rapi.getRoutingQueues(opts)
          .then((data) => {
            console.log(`getRoutingQueues success! data: ${JSON.stringify(data, null, 2)}`);
            queues = data.entities;
            resolve(queues);
          })
          .catch((err) => {
            console.log("There was a failure calling getRoutingQueues");
            console.error(err);
          });
      });
    }

    async function getFlows() {

      return new Promise((resolve) => {

        let opts = {
          "type": ["inboundemail"], // [String] | Type
          "pageNumber": 1, // Number | Page number
          "pageSize": 100, // Number | Page size
          "sortBy": "name", // String | Sort by
          "sortOrder": "asc", // String | Sort order
          //"id": ["id_example"], // [String] | ID
          //"name": "name_example", // String | Name
          //"description": "description_example", // String | Description
          //"nameOrDescription": "nameOrDescription_example", // String | Name or description
          //"publishVersionId": "publishVersionId_example", // String | Publish version ID
          //"editableBy": "editableBy_example", // String | Editable by
          //"lockedBy": "lockedBy_example", // String | Locked by
          //"lockedByClientId": "lockedByClientId_example", // String | Locked by client ID
          //"secure": "secure_example", // String | Secure
          //"deleted": false, // Boolean | Include deleted
          //"includeSchemas": false, // Boolean | Include variable schemas
          //"publishedAfter": 2015-01-01T12:00:00-0600, 2015-01-01T18:00:00Z, 2015-01-01T12:00:00.000-0600, 2015-01-01T18:00:00.000Z, 2015-01-01, // String | Published after
          //"publishedBefore": 2015-01-01T12:00:00-0600, 2015-01-01T18:00:00Z, 2015-01-01T12:00:00.000-0600, 2015-01-01T18:00:00.000Z, 2015-01-01, // String | Published before
          //"divisionId": ["divisionId_example"] // [String] | division ID(s)
        };

        // Get a pageable list of flows, filtered by query parameters
        aapi.getFlows(opts)
          .then((data) => {
            console.log(`getFlows success! data: ${JSON.stringify(data, null, 2)}`);
            flows = data.entities;
            resolve(flows);
          })
          .catch((err) => {
            console.log("There was a failure calling getFlows");
            console.error(err);
            resolve();
          });
      });
    }

    async function getWorkItemInfo() {

      await Promise.all([
        getWorkBins(),
        agetWorkTypes(),
        getSchemas(),
      ]);

      /*  workbins = [
         {
           "id": "12ccb84f-9c9e-4c9e-9fb9-261dfb1bbfc4",
           "name": "Workbin 1",
           "division": {
             "id": "b3c5f7a5-9439-4572-ba4c-ae168ed2ef29",
             "selfUri": "/api/v2/authorization/divisions/b3c5f7a5-9439-4572-ba4c-ae168ed2ef29"
           },
           "dateCreated": "2022-11-18T18:16:08.555Z",
           "dateModified": "2022-11-18T18:16:08.555Z",
           "modifiedBy": {
             "id": "8ce2f903-78e6-4b50-b7aa-e1aa7e7c39ac",
             "selfUri": "/api/v2/users/8ce2f903-78e6-4b50-b7aa-e1aa7e7c39ac"
           },
           "selfUri": "/api/v2/taskmanagement/workbins/12ccb84f-9c9e-4c9e-9fb9-261dfb1bbfc4"
         },
         {
           "id": "01b0ccfa-0ef3-4568-8c27-e2dca354ec54",
           "name": "Medical Waste",
           "division": {
             "id": "98c0531c-34a5-438e-95e6-c3d93324f733",
             "selfUri": "/api/v2/authorization/divisions/98c0531c-34a5-438e-95e6-c3d93324f733"
           },
           "description": "Sample Medical Waste Workbin for Stericycle",
           "dateCreated": "2025-02-17T17:53:31.181Z",
           "dateModified": "2025-02-17T17:53:31.181Z",
           "modifiedBy": {
             "id": "8ce2f903-78e6-4b50-b7aa-e1aa7e7c39ac",
             "selfUri": "/api/v2/users/8ce2f903-78e6-4b50-b7aa-e1aa7e7c39ac"
           },
           "selfUri": "/api/v2/taskmanagement/workbins/01b0ccfa-0ef3-4568-8c27-e2dca354ec54"
         }
       ] */


      /*  workTypes = [
         {
           "id": "951eb227-8ac5-447e-9847-572151e8178a",
           "name": "WorkType 1",
           "division": {
             "id": "b3c5f7a5-9439-4572-ba4c-ae168ed2ef29",
             "selfUri": "/api/v2/authorization/divisions/b3c5f7a5-9439-4572-ba4c-ae168ed2ef29"
           },
           "description": "This is a Test Worktype",
           "dateCreated": "2022-11-18T18:16:11.777Z",
           "dateModified": "2023-04-18T19:51:56.150Z",
           "defaultWorkbin": {
             "id": "12ccb84f-9c9e-4c9e-9fb9-261dfb1bbfc4",
             "name": "Workbin 1",
             "selfUri": "/api/v2/taskmanagement/workbins/12ccb84f-9c9e-4c9e-9fb9-261dfb1bbfc4"
           },
           "defaultStatus": {
             "id": "56f1bafe-7c19-44f3-b029-10324ee64349",
             "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a/statuses/56f1bafe-7c19-44f3-b029-10324ee64349"
           },
           "statuses": [
             {
               "id": "56f1bafe-7c19-44f3-b029-10324ee64349",
               "name": "Open",
               "category": "Open",
               "destinationStatuses": [],
               "defaultDestinationStatus": {
                 "id": "a1bb02ab-4642-408e-8cd9-06ae45460a45",
                 "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a/statuses/a1bb02ab-4642-408e-8cd9-06ae45460a45"
               },
               "statusTransitionDelaySeconds": 300,
               "worktype": {
                 "id": "951eb227-8ac5-447e-9847-572151e8178a",
                 "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a"
               },
               "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a/statuses/56f1bafe-7c19-44f3-b029-10324ee64349"
             },
             {
               "id": "1cd46550-acdf-4148-9ef4-c1e81d77bd53",
               "name": "Closed",
               "category": "Closed",
               "destinationStatuses": [],
               "worktype": {
                 "id": "951eb227-8ac5-447e-9847-572151e8178a",
                 "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a"
               },
               "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a/statuses/1cd46550-acdf-4148-9ef4-c1e81d77bd53"
             },
             {
               "id": "a1bb02ab-4642-408e-8cd9-06ae45460a45",
               "name": "Sending SMS",
               "category": "InProgress",
               "destinationStatuses": [],
               "description": "",
               "worktype": {
                 "id": "951eb227-8ac5-447e-9847-572151e8178a",
                 "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a"
               },
               "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a/statuses/a1bb02ab-4642-408e-8cd9-06ae45460a45"
             },
             {
               "id": "f558e13e-6894-4e2a-b4b1-c2364178b3c2",
               "name": "Sending SMS x2",
               "category": "InProgress",
               "destinationStatuses": [],
               "description": "",
               "worktype": {
                 "id": "951eb227-8ac5-447e-9847-572151e8178a",
                 "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a"
               },
               "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a/statuses/f558e13e-6894-4e2a-b4b1-c2364178b3c2"
             }
           ],
           "defaultDurationSeconds": 1296000,
           "defaultExpirationSeconds": 7762708,
           "defaultDueDurationSeconds": 258,
           "defaultPriority": 0,
           "defaultLanguage": {
             "id": "689c54eb-5849-4375-9f51-a83b6a6ddc23",
             "selfUri": "/api/v2/routing/languages/689c54eb-5849-4375-9f51-a83b6a6ddc23"
           },
           "defaultTtlSeconds": 31536000,
           "modifiedBy": {
             "id": "8ce2f903-78e6-4b50-b7aa-e1aa7e7c39ac",
             "selfUri": "/api/v2/users/8ce2f903-78e6-4b50-b7aa-e1aa7e7c39ac"
           },
           "defaultQueue": {
             "id": "fca4fec9-9188-4b00-a089-0c0190524a15",
             "selfUri": "/api/v2/routing/queues/fca4fec9-9188-4b00-a089-0c0190524a15"
           },
           "defaultSkills": [],
           "assignmentEnabled": true,
           "schema": {},
           "flow": {},
           "selfUri": "/api/v2/taskmanagement/worktypes/951eb227-8ac5-447e-9847-572151e8178a"
         },
         {
           "id": "63746c1c-d21e-4e77-95fc-c522febcc28b",
           "name": "Pharmaceutical Waste",
           "division": {
             "id": "98c0531c-34a5-438e-95e6-c3d93324f733",
             "selfUri": "/api/v2/authorization/divisions/98c0531c-34a5-438e-95e6-c3d93324f733"
           },
           "description": "Sample Pharmaceutical Waste Worktype",
           "dateCreated": "2025-02-17T17:54:37.938Z",
           "dateModified": "2025-03-10T14:34:32.886Z",
           "defaultWorkbin": {
             "id": "01b0ccfa-0ef3-4568-8c27-e2dca354ec54",
             "name": "Medical Waste",
             "selfUri": "/api/v2/taskmanagement/workbins/01b0ccfa-0ef3-4568-8c27-e2dca354ec54"
           },
           "defaultStatus": {
             "id": "ea5d038a-b916-4faf-ae5b-449de0456e24",
             "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b/statuses/ea5d038a-b916-4faf-ae5b-449de0456e24"
           },
           "statuses": [
             {
               "id": "ea5d038a-b916-4faf-ae5b-449de0456e24",
               "name": "Open",
               "category": "Open",
               "destinationStatuses": [],
               "worktype": {
                 "id": "63746c1c-d21e-4e77-95fc-c522febcc28b",
                 "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b"
               },
               "autoTerminateWorkitem": null,
               "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b/statuses/ea5d038a-b916-4faf-ae5b-449de0456e24"
             },
             {
               "id": "decb86d2-a195-4659-b564-8ccedf711e3a",
               "name": "Closed",
               "category": "Closed",
               "destinationStatuses": [],
               "worktype": {
                 "id": "63746c1c-d21e-4e77-95fc-c522febcc28b",
                 "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b"
               },
               "autoTerminateWorkitem": null,
               "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b/statuses/decb86d2-a195-4659-b564-8ccedf711e3a"
             },
             {
               "id": "f2906466-95b2-44a2-a3cd-ba75d7f58080",
               "name": "Created",
               "category": "Open",
               "destinationStatuses": [],
               "description": "",
               "defaultDestinationStatus": {
                 "id": "8a02018f-b5e2-4e6b-bdaf-d40d6c924c5b",
                 "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b/statuses/8a02018f-b5e2-4e6b-bdaf-d40d6c924c5b"
               },
               "statusTransitionDelaySeconds": 86400,
               "worktype": {
                 "id": "63746c1c-d21e-4e77-95fc-c522febcc28b",
                 "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b"
               },
               "autoTerminateWorkitem": null,
               "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b/statuses/f2906466-95b2-44a2-a3cd-ba75d7f58080"
             },
             {
               "id": "7df00345-4759-48b3-8e19-5017c74cfee2",
               "name": "Processing Case",
               "category": "InProgress",
               "destinationStatuses": [],
               "description": "",
               "worktype": {
                 "id": "63746c1c-d21e-4e77-95fc-c522febcc28b",
                 "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b"
               },
               "autoTerminateWorkitem": null,
               "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b/statuses/7df00345-4759-48b3-8e19-5017c74cfee2"
             },
             {
               "id": "8a02018f-b5e2-4e6b-bdaf-d40d6c924c5b",
               "name": "Peter's Status",
               "category": "Open",
               "destinationStatuses": [
                 {
                   "id": "ea5d038a-b916-4faf-ae5b-449de0456e24",
                   "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b/statuses/ea5d038a-b916-4faf-ae5b-449de0456e24"
                 },
                 {
                   "id": "f2906466-95b2-44a2-a3cd-ba75d7f58080",
                   "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b/statuses/f2906466-95b2-44a2-a3cd-ba75d7f58080"
                 },
                 {
                   "id": "decb86d2-a195-4659-b564-8ccedf711e3a",
                   "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b/statuses/decb86d2-a195-4659-b564-8ccedf711e3a"
                 }
               ],
               "description": "",
               "worktype": {
                 "id": "63746c1c-d21e-4e77-95fc-c522febcc28b",
                 "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b"
               },
               "autoTerminateWorkitem": null,
               "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b/statuses/8a02018f-b5e2-4e6b-bdaf-d40d6c924c5b"
             }
           ],
           "defaultDurationSeconds": 604800,
           "defaultExpirationSeconds": 5097600,
           "defaultDueDurationSeconds": 1296000,
           "defaultPriority": 0,
           "defaultLanguage": {},
           "defaultTtlSeconds": 5184000,
           "modifiedBy": {
             "id": "8ce2f903-78e6-4b50-b7aa-e1aa7e7c39ac",
             "selfUri": "/api/v2/users/8ce2f903-78e6-4b50-b7aa-e1aa7e7c39ac"
           },
           "defaultQueue": {
             "id": "2cda8eb4-a53b-439f-98c3-0c2508c87e5c",
             "selfUri": "/api/v2/routing/queues/2cda8eb4-a53b-439f-98c3-0c2508c87e5c"
           },
           "defaultSkills": [],
           "assignmentEnabled": false,
           "schema": {
             "id": "64427c59-e721-48af-8914-e20954624ecc",
             "selfUri": "/api/v2/taskmanagement/workitems/schemas/64427c59-e721-48af-8914-e20954624ecc"
           },
           "serviceLevelTarget": 100,
           "ruleSettings": {
             "flowRulesEnabled": true
           },
           "flow": {
             "id": "96487adb-ec13-48f1-af4c-96db6d64b4bd",
             "selfUri": "/api/v2/flows/96487adb-ec13-48f1-af4c-96db6d64b4bd"
           },
           "defaultScript": {
             "id": "042f5bd8-db49-4307-9ed8-33d42eb8502c",
             "selfUri": "/api/v2/scripts/042f5bd8-db49-4307-9ed8-33d42eb8502c"
           },
           "selfUri": "/api/v2/taskmanagement/worktypes/63746c1c-d21e-4e77-95fc-c522febcc28b"
         }
       ]
  */

      // Get a list of schemas.
      /* schemas = {
        "total": 2,
        "entities": [
          {
            "id": "64427c59-e721-48af-8914-e20954624ecc",
            "name": "Sample Schema - Stericycle",
            "version": 1,
            "appliesTo": [
              "WORKITEM"
            ],
            "enabled": true,
            "deleted": false,
            "createdBy": {
              "id": "8ce2f903-78e6-4b50-b7aa-e1aa7e7c39ac",
              "selfUri": "/api/v2/users/8ce2f903-78e6-4b50-b7aa-e1aa7e7c39ac"
            },
            "dateCreated": "2025-02-17T17:51:35Z",
            "jsonSchema": {
              "$schema": "http://json-schema.org/draft-04/schema#",
              "title": "Sample Schema - Stericycle",
              "description": "This is a sample schema for modeling the Stericycle Objects",
              "properties": {
                "accountid_identifier": {
                  "title": "AccountID",
                  "description": "This is the AccountID that came from Salesforce.",
                  "minLength": 0,
                  "maxLength": 100,
                  "allOf": [
                    {
                      "$ref": "#/definitions/identifier"
                    }
                  ]
                },
                "caseid_identifier": {
                  "title": "CaseID",
                  "description": "This is the CaseID that came from Salesforce.",
                  "minLength": 0,
                  "maxLength": 100,
                  "allOf": [
                    {
                      "$ref": "#/definitions/identifier"
                    }
                  ]
                },
                "createddate_datetime": {
                  "title": "CreatedDate",
                  "description": "This is the Created Date field",
                  "allOf": [
                    {
                      "$ref": "#/definitions/datetime"
                    }
                  ]
                },
                "casenumber_integer": {
                  "title": "CaseNumber",
                  "description": "This is the Case Number value from Salesforce",
                  "minimum": 0,
                  "maximum": 1000,
                  "allOf": [
                    {
                      "$ref": "#/definitions/integer"
                    }
                  ]
                },
                "sitenumber_number": {
                  "title": "SiteNumber",
                  "description": "This is the Site Number field from Salesforce",
                  "minimum": 0,
                  "maximum": 1000000,
                  "allOf": [
                    {
                      "$ref": "#/definitions/number"
                    }
                  ]
                },
                "servicearea_enum": {
                  "title": "ServiceArea",
                  "description": "This is the Service Area Field",
                  "enum": [
                    "west_coast",
                    "midwest",
                    "east_coast",
                    "south"
                  ],
                  "_enumProperties": {
                    "west_coast": {
                      "title": "West Coast",
                      "_disabled": false
                    },
                    "midwest": {
                      "title": "Midwest",
                      "_disabled": false
                    },
                    "east_coast": {
                      "title": "East Coast",
                      "_disabled": false
                    },
                    "south": {
                      "title": "South",
                      "_disabled": false
                    }
                  },
                  "allOf": [
                    {
                      "$ref": "#/definitions/enum"
                    }
                  ]
                },
                "isgovernment_checkbox": {
                  "title": "isGovernment",
                  "allOf": [
                    {
                      "$ref": "#/definitions/checkbox"
                    }
                  ]
                }
              },
              "definitions": {
                "text": {
                  "title": "Text",
                  "description": "A single line string",
                  "type": "string",
                  "selfUri": "/api/v2/dataextensions/coretypes/text"
                },
                "longtext": {
                  "title": "Long Text",
                  "description": "A multi-line string",
                  "type": "string",
                  "selfUri": "/api/v2/dataextensions/coretypes/longtext"
                },
                "url": {
                  "title": "URL",
                  "description": "A single-line string containing a URL",
                  "type": "string",
                  "selfUri": "/api/v2/dataextensions/coretypes/url"
                },
                "identifier": {
                  "title": "Identifier",
                  "description": "A single line string identifier",
                  "type": "string",
                  "selfUri": "/api/v2/dataextensions/coretypes/identifier"
                },
                "enum": {
                  "title": "Enum",
                  "description": "A unique list of strings",
                  "type": "string",
                  "selfUri": "/api/v2/dataextensions/coretypes/enum"
                },
                "date": {
                  "title": "Date",
                  "description": "An ISO-8601 date with format YYYY-MM-DD",
                  "type": "string",
                  "pattern": "^\\d{4}\\-(0[1-9]|1[012])\\-(0[1-9]|[12][0-9]|3[01])$",
                  "selfUri": "/api/v2/dataextensions/coretypes/date"
                },
                "datetime": {
                  "title": "Date Time",
                  "description": "An ISO-8601 GMT date with time. Format: YYYY-MM-DDTHH:mm:ss.sssZ",
                  "type": "string",
                  "pattern": "^\\d{4}\\-(0[1-9]|1[012])\\-(0[1-9]|[12][0-9]|3[01])T(0[0-9]|1[0-9]|2[0-3])\\:([0-5][0-9])\\:([0-5][0-9])\\.\\d{3}Z$",
                  "selfUri": "/api/v2/dataextensions/coretypes/datetime"
                },
                "integer": {
                  "title": "Integer",
                  "description": "An integer",
                  "type": "integer",
                  "selfUri": "/api/v2/dataextensions/coretypes/integer"
                },
                "number": {
                  "title": "Number",
                  "description": "A decimal number",
                  "type": "number",
                  "selfUri": "/api/v2/dataextensions/coretypes/number"
                },
                "checkbox": {
                  "title": "Checkbox",
                  "description": "Represents a selection toggle that can be in one of three states: true, false, or null",
                  "type": [
                    "boolean",
                    "null"
                  ],
                  "selfUri": "/api/v2/dataextensions/coretypes/checkbox"
                },
                "tag": {
                  "title": "Tag",
                  "description": "Represents a tag string value. Tags must be associated with an array and added to the items list.",
                  "type": "array",
                  "items": {
                    "type": "string",
                    "pattern": "^[\\S]+$"
                  },
                  "selfUri": "/api/v2/dataextensions/coretypes/tag"
                }
              }
            },
            "selfUri": "/api/v2/taskmanagement/workitems/schemas/64427c59-e721-48af-8914-e20954624ecc"
          },
          {
            "id": "945466e0-c2df-4e52-a037-466ec9cb30fe",
            "name": "Sample Simple Schema",
            "version": 1,
            "appliesTo": [
              "WORKITEM"
            ],
            "enabled": true,
            "deleted": false,
            "createdBy": {
              "id": "f1804415-bca9-4eb7-ad5a-521fca8d6128",
              "selfUri": "/api/v2/users/f1804415-bca9-4eb7-ad5a-521fca8d6128"
            },
            "dateCreated": "2025-04-25T14:14:06Z",
            "jsonSchema": {
              "$schema": "http://json-schema.org/draft-04/schema#",
              "title": "Sample Simple Schema",
              "description": "",
              "properties": {
                "case_url_url": {
                  "title": "Case URL",
                  "minLength": 0,
                  "maxLength": 200,
                  "allOf": [
                    {
                      "$ref": "#/definitions/url"
                    }
                  ]
                },
                "case_description_text": {
                  "title": "Case Description",
                  "minLength": 0,
                  "maxLength": 100,
                  "allOf": [
                    {
                      "$ref": "#/definitions/text"
                    }
                  ]
                },
                "case_status_enum": {
                  "title": "Case Status",
                  "enum": [
                    "open",
                    "closed",
                    "pending"
                  ],
                  "_enumProperties": {
                    "open": {
                      "title": "Open",
                      "_disabled": false
                    },
                    "closed": {
                      "title": "Closed",
                      "_disabled": false
                    },
                    "pending": {
                      "title": "Pending",
                      "_disabled": false
                    }
                  },
                  "allOf": [
                    {
                      "$ref": "#/definitions/enum"
                    }
                  ]
                }
              },
              "definitions": {
                "text": {
                  "title": "Text",
                  "description": "A single line string",
                  "type": "string",
                  "selfUri": "/api/v2/dataextensions/coretypes/text"
                },
                "longtext": {
                  "title": "Long Text",
                  "description": "A multi-line string",
                  "type": "string",
                  "selfUri": "/api/v2/dataextensions/coretypes/longtext"
                },
                "url": {
                  "title": "URL",
                  "description": "A single-line string containing a URL",
                  "type": "string",
                  "selfUri": "/api/v2/dataextensions/coretypes/url"
                },
                "identifier": {
                  "title": "Identifier",
                  "description": "A single line string identifier",
                  "type": "string",
                  "selfUri": "/api/v2/dataextensions/coretypes/identifier"
                },
                "enum": {
                  "title": "Enum",
                  "description": "A unique list of strings",
                  "type": "string",
                  "selfUri": "/api/v2/dataextensions/coretypes/enum"
                },
                "date": {
                  "title": "Date",
                  "description": "An ISO-8601 date with format YYYY-MM-DD",
                  "type": "string",
                  "pattern": "^\\d{4}\\-(0[1-9]|1[012])\\-(0[1-9]|[12][0-9]|3[01])$",
                  "selfUri": "/api/v2/dataextensions/coretypes/date"
                },
                "datetime": {
                  "title": "Date Time",
                  "description": "An ISO-8601 GMT date with time. Format: YYYY-MM-DDTHH:mm:ss.sssZ",
                  "type": "string",
                  "pattern": "^\\d{4}\\-(0[1-9]|1[012])\\-(0[1-9]|[12][0-9]|3[01])T(0[0-9]|1[0-9]|2[0-3])\\:([0-5][0-9])\\:([0-5][0-9])\\.\\d{3}Z$",
                  "selfUri": "/api/v2/dataextensions/coretypes/datetime"
                },
                "integer": {
                  "title": "Integer",
                  "description": "An integer",
                  "type": "integer",
                  "selfUri": "/api/v2/dataextensions/coretypes/integer"
                },
                "number": {
                  "title": "Number",
                  "description": "A decimal number",
                  "type": "number",
                  "selfUri": "/api/v2/dataextensions/coretypes/number"
                },
                "checkbox": {
                  "title": "Checkbox",
                  "description": "Represents a selection toggle that can be in one of three states: true, false, or null",
                  "type": [
                    "boolean",
                    "null"
                  ],
                  "selfUri": "/api/v2/dataextensions/coretypes/checkbox"
                },
                "tag": {
                  "title": "Tag",
                  "description": "Represents a tag string value. Tags must be associated with an array and added to the items list.",
                  "type": "array",
                  "items": {
                    "type": "string",
                    "pattern": "^[\\S]+$"
                  },
                  "selfUri": "/api/v2/dataextensions/coretypes/tag"
                }
              }
            },
            "selfUri": "/api/v2/taskmanagement/workitems/schemas/945466e0-c2df-4e52-a037-466ec9cb30fe"
          }
        ]
      }
      selectedSchema = schemas.entities[0]; */

      ;


    }

    async function displayConversationIdWork() {

      const conversationIdDisplay = document.getElementById('conversationIdDisplay');
      conversationIdDisplay.textContent = `${lastConversationId}`;
      conversationIdDisplay.parentElement.style.visibility = 'visible';
    }

    function createWorkItemForm() {
      const form = document.getElementById('dynamicForm');
      const formSchema = document.getElementById('dynamicFormSchema');
      form.innerHTML = ''; // Clear existing form content
      formSchema.innerHTML = ''; // Clear existing form content


      let itemName = document.createElement('gux-form-field-text-like')
      let itemNameInput = document.createElement('input');
      itemNameInput.setAttribute('type', 'text');
      itemNameInput.setAttribute('id', 'itemName');
      itemNameInput.setAttribute('name', 'itemName');
      itemNameInput.setAttribute('slot', 'input');
      itemNameInput.setAttribute('maxlength', '100');
      itemNameInput.setAttribute('placeholder', 'Enter Item Name');
      itemNameInput.setAttribute('required', 'true');
      let itemNameLabel = document.createElement('label');
      itemNameLabel.setAttribute('for', 'itemName');
      itemNameLabel.setAttribute('slot', 'label');
      itemNameLabel.textContent = 'Item Name: ';
      itemName.appendChild(itemNameInput);
      itemName.appendChild(itemNameLabel);
      form.appendChild(itemName);
      //form.appendChild(document.createElement('br'));
      form.appendChild(document.createElement('br'));

      //Priority
      let itemPriority = document.createElement('gux-form-field-number')
      let itemPriorityInput = document.createElement('input');
      itemPriorityInput.setAttribute('type', 'number');
      itemPriorityInput.setAttribute('id', 'itemPriority');
      itemPriorityInput.setAttribute('name', 'itemPriority');
      itemPriorityInput.setAttribute('slot', 'input');
      itemPriorityInput.setAttribute('min', '0');
      itemPriorityInput.setAttribute('max', '9999999999');
      itemPriorityInput.setAttribute('placeholder', 'Enter Item Priority');
      itemPriorityInput.setAttribute('required', 'true');
      let itemPriorityLabel = document.createElement('label');
      itemPriorityLabel.setAttribute('for', 'itemPriority');
      itemPriorityLabel.setAttribute('slot', 'label');
      itemPriorityLabel.textContent = 'Item Priority: ';
      itemPriority.appendChild(itemPriorityInput);
      itemPriority.appendChild(itemPriorityLabel);
      form.appendChild(itemPriority);
      //form.appendChild(document.createElement('br'));
      form.appendChild(document.createElement('br'));

      //Worktype
      let typefield = document.createElement('gux-form-field-select')
      let typeinput = document.createElement('select');
      typeinput.setAttribute('id', 'workTypeSelection');
      typeinput.setAttribute('name', 'workTypeSelection');
      typeinput.setAttribute('slot', 'input');
      workTypes.forEach(optionValue => {
        const option = document.createElement('option');
        option.setAttribute('value', optionValue.id);
        option.textContent = optionValue.name;
        typeinput.appendChild(option);
      });
      let label = document.createElement('label');
      label.setAttribute('for', 'workTypeSelection');
      label.textContent = 'Worktype: ';
      label.setAttribute('slot', 'label');
      typefield.appendChild(typeinput);
      typefield.appendChild(label);
      form.appendChild(typefield);
      //form.appendChild(document.createElement('br'));
      form.appendChild(document.createElement('br'));

      //Workbin
      let wbfield = document.createElement('gux-form-field-select')
      let wbinput = document.createElement('select');
      wbinput.setAttribute('id', 'workBinSelection');
      wbinput.setAttribute('name', 'workBinSelection');
      wbinput.setAttribute('slot', 'input');
      workbins.forEach(optionValue => {
        const option = document.createElement('option');
        option.setAttribute('value', optionValue.id);
        option.textContent = optionValue.name;
        wbinput.appendChild(option);
      });
      label = document.createElement('label');
      label.setAttribute('for', 'workBinSelection');
      label.textContent = 'Workbin: ';
      label.setAttribute('slot', 'label');
      wbfield.appendChild(wbinput);
      wbfield.appendChild(label);
      form.appendChild(wbfield);
      //form.appendChild(document.createElement('br'));
      form.appendChild(document.createElement('br'));



      //Due date

      let dueDateDiv = document.createElement('div')
      let dueDateInnerDiv = document.createElement('div');
      dueDateInnerDiv.setAttribute('class', 'datePickerClass');
      let dueDate = document.createElement('gux-datepicker');
      dueDate.setAttribute('format', 'yyyy-mm-dd');
      dueDate.setAttribute('id', 'dueDate');
      dueDate.setAttribute('name', 'dueDate');
      let dueTime = document.createElement('gux-time-picker');
      dueTime.setAttribute('step', '1');
      dueTime.setAttribute('clock-type', '12h');
      dueTime.setAttribute('id', 'dueTime');
      dueDateInnerDiv.appendChild(dueDate);
      dueDateInnerDiv.appendChild(dueTime);
      label = document.createElement('label');
      label.setAttribute('for', 'dueDate');
      label.textContent = 'Due Date: ';
      dueDateDiv.appendChild(label);
      dueDateDiv.appendChild(dueDateInnerDiv);
      form.appendChild(dueDateDiv);
      form.appendChild(document.createElement('br'));
      //form.appendChild(document.createElement('br'));

      //Expire Date

      let expireDateDiv = document.createElement('div')
      let expireDateInnerDiv = document.createElement('div');
      expireDateInnerDiv.setAttribute('class', 'datePickerClass');
      let expireDate = document.createElement('gux-datepicker');
      expireDate.setAttribute('format', 'yyyy-mm-dd');
      expireDate.setAttribute('id', 'expireDate');
      expireDate.setAttribute('name', 'expireDate');
      let expireTime = document.createElement('gux-time-picker');
      expireTime.setAttribute('step', '1');
      expireTime.setAttribute('clock-type', '12h');
      expireTime.setAttribute('id', 'expireTime');
      expireDateInnerDiv.appendChild(expireDate);
      expireDateInnerDiv.appendChild(expireTime);
      label = document.createElement('label');
      label.setAttribute('for', 'expireDate');
      label.textContent = 'Expire Date: ';
      expireDateDiv.appendChild(label);
      expireDateDiv.appendChild(expireDateInnerDiv);
      form.appendChild(expireDateDiv);
      form.appendChild(document.createElement('br'));
      //form.appendChild(document.createElement('br'));

      // schemas
      let schemafield = document.createElement('gux-form-field-select')
      let schemainput = document.createElement('select');
      schemainput.setAttribute('id', 'schemaSelection');
      schemainput.setAttribute('name', 'schemaSelection');
      schemainput.setAttribute('slot', 'input');
      schemas.entities.forEach(optionValue => {
        const option = document.createElement('option');
        option.setAttribute('value', optionValue.id);
        option.textContent = optionValue.name;
        schemainput.appendChild(option);
      });
      label = document.createElement('label');
      label.setAttribute('for', 'schemaSelection');
      label.setAttribute('slot', 'label');
      label.textContent = 'Schema: ';
      schemafield.appendChild(schemainput);
      schemafield.appendChild(label);
      form.appendChild(schemafield);
      form.appendChild(document.createElement('br'));
      //form.appendChild(document.createElement('br'));

      UpdateSchema();
      // set up a listner for changes to schema
      schemainput.addEventListener('change', function () {
        selectedSchema = schemas.entities.find(schema => schema.id === schemainput.value);

        console.log(JSON.stringify(selectedSchema, null, 2));
        UpdateSchema();
      });



      let buttonDiv = document.createElement('div');
      buttonDiv.setAttribute('class', 'buttonDiv');
      const submitButton = document.createElement('gux-button');
      submitButton.setAttribute('accent', 'primary');
      submitButton.setAttribute('onClick', 'createWorkItem()')
      submitButton.innerText = 'Create Work Item';
      let requestButton = document.createElement('gux-button');
      requestButton.setAttribute('accent', 'secondary');
      requestButton.setAttribute('onClick', 'showRequest()')
      requestButton.innerText = 'Show Request';
      buttonDiv.appendChild(submitButton);
      buttonDiv.appendChild(requestButton);

      let resultCopyArea = document.createElement('gux-copy-to-clipboard');
      let conversationIdDisplay = document.createElement('div');
      conversationIdDisplay.setAttribute('id', 'conversationIdDisplay');
      conversationIdDisplay.setAttribute('slot', 'content');
      resultCopyArea.appendChild(conversationIdDisplay);
      resultCopyArea.style.visibility = 'hidden';
      buttonDiv.appendChild(resultCopyArea);


      form.appendChild(buttonDiv);

    }

    function createEmailForm() {
      const form = document.getElementById('dynamicEmailForm');
      const formSchema = document.getElementById('dynamicEmailFormSchema');
      form.innerHTML = ''; // Clear existing form content
      formSchema.innerHTML = ''; // Clear existing form content



      //subject
      let itemName = document.createElement('gux-form-field-text-like')
      let itemNameInput = document.createElement('input');
      itemNameInput.setAttribute('type', 'text');
      itemNameInput.setAttribute('id', 'emailSubject');
      itemNameInput.setAttribute('name', 'emailSubject');
      itemNameInput.setAttribute('slot', 'input');
      itemNameInput.setAttribute('maxlength', '100');
      itemNameInput.setAttribute('placeholder', 'Enter Subject');
      itemNameInput.setAttribute('required', 'true');
      let itemNameLabel = document.createElement('label');
      itemNameLabel.setAttribute('for', 'emailSubject');
      itemNameLabel.setAttribute('slot', 'label');
      itemNameLabel.textContent = 'Email Subject: ';
      itemName.appendChild(itemNameInput);
      itemName.appendChild(itemNameLabel);
      form.appendChild(itemName);
      //form.appendChild(document.createElement('br'));
      form.appendChild(document.createElement('br'));

      //remoteName
      itemName = document.createElement('gux-form-field-text-like')
      itemNameInput = document.createElement('input');
      itemNameInput.setAttribute('type', 'text');
      itemNameInput.setAttribute('id', 'emailRemoteName');
      itemNameInput.setAttribute('name', 'emailRemoteName');
      itemNameInput.setAttribute('slot', 'input');
      itemNameInput.setAttribute('maxlength', '100');
      itemNameInput.setAttribute('placeholder', 'Enter remote name');
      itemNameInput.setAttribute('required', 'true');
      itemNameLabel = document.createElement('label');
      itemNameLabel.setAttribute('for', 'emailRemoteName');
      itemNameLabel.setAttribute('slot', 'label');
      itemNameLabel.textContent = 'Email remote name: ';
      itemName.appendChild(itemNameInput);
      itemName.appendChild(itemNameLabel);
      form.appendChild(itemName);
      //form.appendChild(document.createElement('br'));
      form.appendChild(document.createElement('br'));


      //Priority
      let itemPriority = document.createElement('gux-form-field-number')
      let itemPriorityInput = document.createElement('input');
      itemPriorityInput.setAttribute('type', 'number');
      itemPriorityInput.setAttribute('id', 'emailPriority');
      itemPriorityInput.setAttribute('name', 'emailPriority');
      itemPriorityInput.setAttribute('slot', 'input');
      itemPriorityInput.setAttribute('min', '0');
      itemPriorityInput.setAttribute('max', '9999999999');
      itemPriorityInput.setAttribute('placeholder', 'Enter Email Priority');
      itemPriorityInput.setAttribute('required', 'true');
      let itemPriorityLabel = document.createElement('label');
      itemPriorityLabel.setAttribute('for', 'itemPriority');
      itemPriorityLabel.setAttribute('slot', 'label');
      itemPriorityLabel.textContent = 'Item Priority: ';
      itemPriority.appendChild(itemPriorityInput);
      itemPriority.appendChild(itemPriorityLabel);
      form.appendChild(itemPriority);
      //form.appendChild(document.createElement('br'));
      form.appendChild(document.createElement('br'));

      //selector
      let selectorfield = document.createElement('gux-segmented-control-beta')
      selectorfield.setAttribute('id', 'emailSelectorField');
      let queueItem = document.createElement('gux-segmented-control-item');
      queueItem.setAttribute('value', 'queue');
      let queueDiv = document.createElement('div')
      queueDiv.setAttribute('slot', 'text');
      queueDiv.innerText = 'Queue';
      queueItem.appendChild(queueDiv);
      let flowItem = document.createElement('gux-segmented-control-item');
      flowItem.setAttribute('value', 'flow');
      let flowDiv = document.createElement('div')
      flowDiv.setAttribute('slot', 'text');
      flowDiv.innerText = 'Flow';
      flowItem.appendChild(flowDiv);
      selectorfield.appendChild(queueItem);
      selectorfield.appendChild(flowItem);
      form.appendChild(selectorfield);

      selectorfield.addEventListener('change', function () {
        const selectedValue = selectorfield.value;
        if (selectedValue === 'queue') {
          document.getElementById('queueField').style.display = 'block';
          document.getElementById('flowField').style.display = 'none';
        } else if (selectedValue === 'flow') {
          document.getElementById('queueField').style.display = 'none';
          document.getElementById('flowField').style.display = 'block';
        }
      });
      

      //Queue
      let queueField = document.createElement('gux-form-field-select')
      queueField.setAttribute('id', 'queueField');
      let queueInput = document.createElement('select');
      queueInput.setAttribute('id', 'queueSelection');
      queueInput.setAttribute('name', 'queueSelection');
      queueInput.setAttribute('slot', 'input');
      queues.forEach(optionValue => {
        const option = document.createElement('option');
        option.setAttribute('value', optionValue.id);
        option.textContent = optionValue.name;
        queueInput.appendChild(option);
      });
      let label = document.createElement('label');
      label.setAttribute('for', 'queueSelection');
      label.textContent = 'Queue: ';
      label.setAttribute('slot', 'label');
      queueField.appendChild(queueInput);
      queueField.appendChild(label);
      form.appendChild(queueField);
      //form.appendChild(document.createElement('br'));
      form.appendChild(document.createElement('br'));

      //Flow
      let flowField = document.createElement('gux-form-field-select')
      flowField.setAttribute('id', 'flowField');
      let flowInput = document.createElement('select');
      flowInput.setAttribute('id', 'flowSelection');
      flowInput.setAttribute('name', 'flowSelection');
      flowInput.setAttribute('slot', 'input');
      flows.forEach(optionValue => {
        const option = document.createElement('option');
        option.setAttribute('value', optionValue.id);
        option.textContent = optionValue.name;
        flowInput.appendChild(option);
      });
      label = document.createElement('label');
      label.setAttribute('for', 'flowSelection');
      label.textContent = 'Flow: ';
      label.setAttribute('slot', 'label');
      flowField.appendChild(flowInput);
      flowField.appendChild(label);
      form.appendChild(flowField);
      //form.appendChild(document.createElement('br'));
      form.appendChild(document.createElement('br'));





      let buttonDiv = document.createElement('div');
      buttonDiv.setAttribute('class', 'buttonDiv');
      const submitButton = document.createElement('gux-button');
      submitButton.setAttribute('accent', 'primary');
      submitButton.setAttribute('onClick', 'createEmail()')
      submitButton.innerText = 'Create Email';
      let requestButton = document.createElement('gux-button');
      requestButton.setAttribute('accent', 'secondary');
      requestButton.setAttribute('onClick', 'showRequestEmail()')
      requestButton.innerText = 'Show Request';
      buttonDiv.appendChild(submitButton);
      buttonDiv.appendChild(requestButton);

      let resultCopyArea = document.createElement('gux-copy-to-clipboard');
      let conversationIdDisplay = document.createElement('div');
      conversationIdDisplay.setAttribute('id', 'conversationIdDisplay');
      conversationIdDisplay.setAttribute('slot', 'content');
      resultCopyArea.appendChild(conversationIdDisplay);
      buttonDiv.appendChild(resultCopyArea);

      form.appendChild(buttonDiv);

      createKeyValuePairInput(formSchema);
      //formSchema.appendChild(document.createElement('br'));

      buttonDiv = document.createElement('div');
      buttonDiv.setAttribute('class', 'buttonDiv');
      let createButton = document.createElement('gux-button');
      createButton.setAttribute('accent', 'primary');
      createButton.setAttribute('onClick', 'createKeyValuePairInput()')
      createButton.innerText = '+ Add Attribute';

      buttonDiv.appendChild(createButton);
      document.getElementById('dynamicEmailFormButton').appendChild(document.createElement('br'));
      document.getElementById('dynamicEmailFormButton').appendChild(buttonDiv);

      

    }

    function deletePair(element) {
      const parent = element.parentElement;
      parent.parentElement.removeChild(parent);
    }

    function UpdateSchema() {


      const formSchema = document.getElementById('dynamicFormSchema');
      let schema = selectedSchema.jsonSchema;
      formSchema.innerHTML = ''; // Clear existing form content
      // Schema
      for (const key in schema.properties) {
        const property = schema.properties[key];
        const label = document.createElement('label');
        label.setAttribute('for', key);
        label.setAttribute('slot', 'label');
        label.textContent = property.title + ':';

        let input, field, df, tf;



        // switch based on reference

        switch (property.allOf[0].$ref) {
          case '#/definitions/identifier':
          case '#/definitions/text':
          case '#/definitions/longtext':
            field = document.createElement('gux-form-field-text-like')
            input = document.createElement('input');
            input.setAttribute('type', 'text');
            input.setAttribute('id', key);
            input.setAttribute('name', key);
            input.setAttribute('slot', 'input');

            if (property.maxLength) input.setAttribute('maxlength', property.maxLength);
            field.appendChild(input);
            field.appendChild(label);
            break;
          case '#/definitions/integer':
            field = document.createElement('gux-form-field-text-like')
            input = document.createElement('input');
            input.setAttribute('type', 'number');
            input.setAttribute('id', key);
            input.setAttribute('name', key);
            input.setAttribute('slot', 'input');
            if (property.minimum) input.setAttribute('min', property.minimum);
            if (property.maximum) input.setAttribute('max', property.maximum);
            field.appendChild(input);
            field.appendChild(label);
            break;
          case '#/definitions/datetime':
            field = document.createElement('div')
            input = document.createElement('div');
            input.setAttribute('class', 'datePickerClass');
            df = document.createElement('gux-datepicker');
            df.setAttribute('format', 'yyyy-mm-dd');
            df.setAttribute('id', key + 'Date');
            df.setAttribute('name', key);
            tf = document.createElement('gux-time-picker');
            tf.setAttribute('step', '1');
            tf.setAttribute('clock-type', '12h');
            tf.setAttribute('id', key + 'Time');
            input.appendChild(df);
            input.appendChild(tf);
            field.appendChild(label);
            field.appendChild(input);

            //input.setAttribute('slot','input');
            break;
          case '#/definitions/checkbox':
            field = document.createElement('gux-form-field-checkbox')
            input = document.createElement('input');

            input.setAttribute('type', 'checkbox');
            input.setAttribute('id', key);
            input.setAttribute('name', key);
            input.setAttribute('slot', 'input');
            field.appendChild(input);
            field.appendChild(label);
            break;
          case '#/definitions/enum':
            field = document.createElement('gux-form-field-select')
            input = document.createElement('select');
            input.setAttribute('id', key);
            input.setAttribute('name', key);
            input.setAttribute('slot', 'input');
            property.enum.forEach(optionValue => {
              const option = document.createElement('option');
              option.setAttribute('value', optionValue);
              option.textContent = property._enumProperties[optionValue].title;
              input.appendChild(option);
            });
            field.appendChild(input);
            field.appendChild(label);
            break;
          case '#/definitions/number':
            field = document.createElement('gux-form-field-number')
            input = document.createElement('input');
            input.setAttribute('type', 'number');
            input.setAttribute('id', key);
            input.setAttribute('name', key);
            input.setAttribute('slot', 'input');
            if (property.minimum) input.setAttribute('min', property.minimum);
            if (property.maximum) input.setAttribute('max', property.maximum);
            field.appendChild(input);
            field.appendChild(label);
            break;
          case '#/definitions/tag':
            field = document.createElement('gux-form-field-text-like')
            input = document.createElement('input');
            input.setAttribute('type', 'text');
            input.setAttribute('id', key);
            input.setAttribute('name', key);
            input.setAttribute('slot', 'input');
            field.appendChild(input);
            field.appendChild(label);
            break;
          default:
            field = document.createElement('gux-form-field-text-like')
            input = document.createElement('input');
            input.setAttribute('type', 'text');
            input.setAttribute('id', key);
            input.setAttribute('name', key);
            input.setAttribute('slot', 'input');
            field.appendChild(input);
            field.appendChild(label);
        }

        formSchema.appendChild(field);

        //formSchema.appendChild(document.createElement('br'));
        formSchema.appendChild(document.createElement('br'));
      }

    }

    function createCustomAttributesWorkItem() {
      return new Promise((resolve) => {
        let schema = selectedSchema.jsonSchema;
        let customAttributes = {};

        // Schema
        for (const key in schema.properties) {
          const property = schema.properties[key];
          let fieldVal = null;
          // switch based on reference

          switch (property.allOf[0].$ref) {
            case '#/definitions/identifier':
            case '#/definitions/text':
            case '#/definitions/longtext':
              fieldVal = document.getElementById(key).value;
              if (fieldVal && fieldVal.length > 0) {
                customAttributes[key] = fieldVal;
              }
              break;
            case '#/definitions/integer':
              fieldVal = parseInt(document.getElementById(key).value);
              if (fieldVal && fieldVal.length > 0) {
                customAttributes[key] = fieldVal;
              }
              break;
            case '#/definitions/datetime':
              customAttributes[key] = `${document.getElementById(key + 'Date').value}T${document.getElementById(key + 'Time').value}:00.000Z`;
              //input.setAttribute('slot','input');
              break;
            case '#/definitions/checkbox':
              customAttributes[key] = document.getElementById(key).checked
              break;
            case '#/definitions/enum':
              customAttributes[key] = document.getElementById(key).value
              break;
            case '#/definitions/number':
              customAttributes[key] = parseFloat(document.getElementById(key).value)
              break;
            case '#/definitions/tag':
              customAttributes[key] = document.getElementById(key).value.split(' ');
              break;
            default:
              customAttributes[key] = document.getElementById(key).value
          }


        }
        resolve(customAttributes);
      });



    }

    function createCustomAttributesEmail() {
      return new Promise((resolve) => {

        let customAttributes = {};

        // Schema
        [...document.getElementById('dynamicEmailFormSchema').children].forEach((element) => {
          //console.log(element);
          if (element.classList.contains('KVPClass')) {
            let keyElement = element.querySelector('input[name="key"]');
            let key = keyElement.value;

            let valueElement = element.querySelector('input[name="value"]');
            let value = valueElement.value

            if (key && key.length > 0) {
              customAttributes[key] = value;
            }
          }

        });
        console.log(customAttributes)
        resolve(customAttributes);
      });



    }


    async function showRequest() {

      let CustomAttributes = await createCustomAttributesWorkItem()
      //console.log(CustomAttributes)

      let body = await createWorkItemBody(CustomAttributes)
      populateRequest(body);

      let modal = document.getElementById("Modal").showModal();

    }

    async function showRequestEmail() {

      let CustomAttributes = await createCustomAttributesEmail()
      //console.log(CustomAttributes)

      let body = await createEmailBody(CustomAttributes)
      //let body = await createCustomAttributesEmail();
      populateRequest(body);

      let modal = document.getElementById("Modal").showModal();

    }
    function populateRequest(jsonBody) {
      let codeblock = document.createElement("code");
      codeblock.setAttribute("class", "language-json");
      let jsonDisplayBlock = document.getElementById("jsonDisplay")
      jsonDisplayBlock.innerHTML = "";
      codeblock.innerHTML = JSON.stringify(jsonBody, null, 2);


      if (navigator.clipboard) {
        let button = document.createElement("gux-button");

        button.innerText = copyButtonLabel;
        jsonDisplayBlock.appendChild(button);

        button.addEventListener("click", async () => {
          await copyCode(jsonDisplayBlock, button);
        });
      }
      jsonDisplayBlock.appendChild(codeblock);

      hljs.highlightAll();
    }

    async function copyCode(block, button) {
      let code = block.querySelector("code");
      let text = code.innerText;

      await navigator.clipboard.writeText(text);

      // visual feedback that task is completed
      button.innerText = "JSON Copied";

      setTimeout(() => {
        button.innerText = copyButtonLabel;
      }, 700);
    }

    async function createKeyValuePairInput(parentElement = document.getElementById('dynamicEmailFormSchema')) {
      let kvpDiv = document.createElement('div');
      kvpDiv.setAttribute('class', 'KVPClass');
      let key = document.createElement('gux-form-field-text-like')
      key.setAttribute('label-position', 'screenreader');
      let keyInput = document.createElement('input');
      keyInput.setAttribute('type', 'text');
      keyInput.setAttribute('id', 'key');
      keyInput.setAttribute('name', 'key');
      keyInput.setAttribute('slot', 'input');
      keyInput.setAttribute('maxlength', '100');
      keyInput.setAttribute('placeholder', 'Enter Key');



      let value = document.createElement('gux-form-field-text-like')
      let valueInput = document.createElement('input');
      valueInput.setAttribute('type', 'text');
      valueInput.setAttribute('id', 'value');
      valueInput.setAttribute('name', 'value');
      valueInput.setAttribute('slot', 'input');
      valueInput.setAttribute('maxlength', '100');
      valueInput.setAttribute('placeholder', 'Enter Value');

      let createButton = document.createElement('gux-button');
      createButton.setAttribute('class', 'removeButton');
      createButton.setAttribute('accent', 'danger');
      createButton.setAttribute('onClick', 'deletePair(this)')
      createButton.innerText = 'Remove';



      key.appendChild(keyInput);
      value.appendChild(valueInput);
      kvpDiv.appendChild(key);
      kvpDiv.appendChild(value);
      kvpDiv.appendChild(createButton);
      kvpDiv.appendChild(document.createElement('br'));
      parentElement.appendChild(kvpDiv);




    }

  </script>


  <gux-tabs class="log-Tabs">
    <gux-tab-list slot="tab-list">
      <gux-tab tab-id="6-1">
        <gux-icon icon-name="agent" decorative="true"></gux-icon>
        Work Items
      </gux-tab>
      <gux-tab tab-id="6-2">
        <gux-icon icon-name="user-directory" decorative="true"></gux-icon>
        Email Object
      </gux-tab>

      <gux-tab tab-id="6-3">
        <gux-icon icon-name="fa/align-justify-regular" decorative="true"></gux-icon>
        Participants
      </gux-tab>

    </gux-tab-list>




    <gux-tab-panel tab-id="6-1">
      <div class="panel-container">
        <fieldset>
          <legend>Work Item Values</legend>
          <div id="dynamicForm"></div>
        </fieldset>
        <fieldset>
          <legend>Schema</legend>
          <div id="dynamicFormSchema"></div>
        </fieldset>
      </div>



    </gux-tab-panel>
    <gux-tab-panel tab-id="6-2">
      <div class="panel-container">
        <fieldset>
          <legend>Email Values</legend>
          <div id="dynamicEmailForm"></div>

        </fieldset>
        <fieldset>
          <legend>Attributes</legend>
          <div id="dynamicEmailFormSchema"></div>
          <div id="dynamicEmailFormButton"></div>
        </fieldset>
      </div>
    </gux-tab-panel>

    <gux-tab-panel tab-id="6-3">
      <div class="participant-panel">
        coming soon

      </div>
    </gux-tab-panel>



  </gux-tabs>



  <gux-modal id="Modal" size="small">
    <div slot="content" class="debug-panel">

      <div>
        <div id="json-div" class="rawDisplay">
          <pre id="jsonDisplay"></pre>
        </div>
      </div>
    </div>
  </gux-modal>




</body>

</html>
<style>
  .datePickerClass {
    display: flex;
    flex-direction: row;
    gap: 10px;
  }

  .datePickerClass>div {
    width: 50%;
  }

  .gux-form-field-text-like {
    margin-bottom: 20px;
  }

  .gux-form-field-textarea {
    margin-bottom: 20px;
  }

  .panel-container {
    width: 100%
  }

  .buttonDiv {
    display: flex;
    gap: 10px;
  }

  .KVPClass {
    display: flex;
    flex-direction: row;
    gap: 10px;
  }

  .removeButton {
    margin-top: 18px;
  }
</style>